# Filmorate
## Схема БД для хранения данных
  
![DB Scheme](db.png)  

## Схема SQL

```sql
CREATE TABLE rating (
  rating_id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar UNIQUE NOT NULL
);

CREATE TABLE films (
  film_id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar NOT NULL,
  description varchar,
  releaseDate date,
  duration integer NOT NULL CHECK (duration > 0),
  rating_id integer REFERENCES rating (rating_id) ON DELETE CASCADE
);

CREATE TABLE genres (
  genre_id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar UNIQUE NOT NULL
);

CREATE TABLE films_genre (
  film_id integer REFERENCES films (film_id) ON DELETE CASCADE NOT NULL,
  genre_id integer REFERENCES genres (genre_id) ON DELETE CASCADE NOT NULL,
  PRIMARY KEY (film_id, genre_id)
);

CREATE TABLE users (
  user_id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  first_name varchar NOT NULL,
  last_name varchar,
  login varchar UNIQUE NOT NULL,
  email varchar,
  birthday date,
  EXCLUDE USING btree (lower(email) WITH =)
);

CREATE TABLE friendship (
  user1_id integer REFERENCES users (user_id) ON DELETE CASCADE NOT NULL,
  user2_id integer REFERENCES users (user_id) ON DELETE CASCADE NOT NULL,
  PRIMARY KEY (user1_id, user2_id)
);

CREATE TABLE likes (
  user_id integer REFERENCES users (user_id) ON DELETE CASCADE NOT NULL,
  film_id integer REFERENCES films (film_id) ON DELETE CASCADE NOT NULL,
  PRIMARY KEY (user_id, film_id)
);
```
